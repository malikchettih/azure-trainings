# Course Overview
## Course Overview
My name is Tim Warner and I'm a full-time Pluralsight trainer and a Microsoft MVP in cloud and data center management. we designed this course to accelerate your success with the Microsoft Azure public cloud platform specifically in the infrastructure as a service IaaS scenario. By the end of this course, you'll be able to plan, implement, and maintain Iaas deployments according to Microsoft best patterns and practices. You'll avoid common pitfalls and ensure that your VMs and Azure are secure, highly available, and fully support your production workloads.

## Configuring Networking, Security, and Storage
### Overview
Hello there, and welcome to Pluralsight, and welcome to this course entitled, Getting Started with Microsoft Azure VMs. This is the first module in the course. Its title is Configuring Networking, Security, and Storage. My name is Tim Warner, and I'm happy to be your instructor. This course is all about best practices for deploying and managing virtual machines or VMs in the Microsoft Azure cloud. To that end, we'll begin by examining software defined networking, specifically how to create a virtual network, how to define subnets, static IP addresses, DNS name resolution. We'll then look at security. That's a big subject unto itself, but we'll constrain ourselves to secure VM access. We'll also, by definition, need to cover what Network Security Groups, NSGs, are, and their best practices for use, and then we have storage, specifically the differences between the managed disk model, and the traditional storage account. Let's get into it. We have a lot of good material to cover. Throughout this course I'll be pointing you to various, relevant Azure oriented websites, as well as sharing some PowerShell, and perhaps even some Azure command line interface, CLI code. In the Pluralsight web player what you'll want to do is from the Course page navigate to the Exercise Files tab. There you'll have a button to download the exercise files. That comes down as a zip archive. Here we can see representative example, and you'll find that for each module in the course there'll be a pdf version of the slide deck, as well as a folder. Inside each module level folder is, at least with my courses, a links list that contains all of the URL references that I give. This is Visual Studio code, and if you are using VSCode I'd suggest that you install the link for VSCode extension, such that my links are clickable, and also, as I said, programmatic code, like Windows PowerShell scripts will be in there as well.

### The Azure Virtual Network in Action
Networking. This course is going to be extremely demo heavy. Normally I'll just present a single slide that sums up the concept, and then we'll get right into the practical meat and potatoes, as it were. In the Azure Resource Manager, ARM model, this is how virtual networks work. They are first of all an isolated container into which you can populate one or more Windows server, and/or Linux virtual machines. Also, understand that in order to support communication between separate Azure virtual networks you'll need to create what's called a vnet to vnet virtual private network or VPN, so these really are these virtual networks isolated security boundaries in the Azure cloud. Within a virtual network you define subnets. First of all, you have your IP address range, and then you subdivide that into, well, subnets, exactly as you do on-prem. The guidance here is that you want to think about what your IP ranges are on-premises, and make sure that you're not inadvertently creating a conflict. The day may come where you want to extend your on-premises networks into an Azure virtual network, and the last thing you want to have to do is unwind IP address conflicts. In this example you see I've created two separate subnets. The hosts within the subnets can resolve each other's names immediately because DNS is active in the Azure cloud. Remember that you'll need additional DNS server addresses to support vnet to vnet name resolution, but DNS is something else we can control in Azure. In this example you see a private 172.16.1 address that could represent a domain controller or just a Linux or a Windows server DNS server in one of your subnets. The 203. looks like a public IP, it's actually in the documentation range, but I use it to simulate a public IP, and what this means is that you can add to the built-in default Azure DNS servers by providing your own internet accessible DNS as well. It all depends upon what your business needs are. Now guidance for deploying subnets? Well, just think of your line of business application. You may want to put the front end servers on one subnet, and the database servers, VMs that is, on a backend subnet, and like I said, because those subnets exist within a virtual network they have easy name resolution. Something else to consider is the Network Security Group, and you combined a Network Security Group that's essentially a software firewall to a subnet, so you can have separate traffic rules on a per subnet basis. We'll get into NSGs shortly.

### Demo: Deploy a Virtual Network
Here we are on a Windows 10 Enterprise edition workstation, and I'm going to show you how to deploy a virtual network in the Azure portal, and then we'll also do some existing work, like how to link a VM to a virtual network, although I don't want to get too far ahead of myself because we cover deployment in the next module, but this is the Azure portal, portal.azure.com. I've authenticated with my administrator subscription, and we can come over to the Favorites bar here, and you'll see I've already pre-populated it with all of the nodes that are relevant for us. If you're not yet familiar with the Azure portal you'll want to get accustomed with this Favorites bar. Alternatively, you can come over to the Global Navigation, start to type, and it will auto-populate search results that you can directly click on. What we're concerned with here is virtual networks, so let me click that, and I'll show you how easy it is to create a virtual network. It's actually deceptively easy. We'll click Add here on the toolbar. We provide it with a friendly name. I'll call it Pluralsight-vnet, and this is where you want to be really careful and think about the address space as the overall IPv4 space that is going to cover that virtual network. I'm going to change it to 172.16.0.0/16. The address space is the overall pool. You then can create one or more subnets that fit within that pool, so prerequisite knowledge would be some understanding of IPv4 networking and IPv4 subnetting. I'll create my first subnet of 172.16.1.0/24, and when you press Tab you notice a validation takes place. If you get a red and white exclamation mark you can hover over it to get additional details of why that choice didn't pass validation. If you get a green check, then you're good to go. Now yes, we can add additional subnets later, it's just we're given the chance to create one in the portal. If you use Windows PowerShell or the Azure CLI you can define as many subnets up front as possible. We associate with a subscription, a resource group, and a location. The subscription should be self-evident. The resource group is a container object. I'm going to reuse the one I've been using all along, but you can create a new one on the fly. Resource groups make it very simple actually to keep your Azure resources together for group management and group accounting. The location is important. Remember that Azure has a worldwide region network. You want to choose the location that's geographically closest to you. You can pin any deployment to the dashboard, and the dashboard is another subject unto itself. It's a great tool. I'm going to leave that unchecked, and we'll click Create to send that deployment into ARM. You'll notice it says Validating here, because under the hood every deployment is validated against what's called the ARM or Azure Resource Manager schema. This little bell icon is for our notifications, and it's useful for checking the status of your deployments. It looks like this one succeeded, and if we come back to our virtual networks list and refresh the view we can now see our Pluralsight-vnet, and we'll give that a click, and let it load up its status page.

### Demo: Configure a Virtual Network
The Essentials pane gives you just at a glance metadata regarding your resource, and you'll notice that in many cases there are hyperlinks that allow you to get to a specific asset. You can collapse the Essentials pane by clicking the little chevron, and then under there there will be various dashboard views that are relevant to the resource that you're looking at. Now I want to draw your attention to the Settings area. If we go to Address Space, and click the ellipses, notice that we can't extend or modify the address space. We can only remove it and start it again. Within that address space we have our subnets list, and we can click Subnet to create an additional one if we want to. How about we have a data subnet that's at 172.16.2.0. We're asked to define a network security group, and a static route table. The network security group we'll revisit in an upcoming demo, so for now I'll click OK to submit this change. Once again, it's added to the deployment queue. That completed pretty quickly. For name resolution we can go to DNS servers, and by default you just rely upon the Microsoft own Azure servers, but if you click Custom we can supply one or more DNS server names or IP addresses, and these could be on-premises DNS servers, as long as you have a site-to-site VPN that is. It could be a DNS server that's running within the virtual network or it could be another first or third party public internet based DNS server. I'm going to discard my change. I'll leave the Azure provided ones there. So that is the virtual network in a nutshell. I strongly suggest that you create your virtual networks first. When you deploy virtual machines the ARM template will auto-generate you a virtual network, and a subnet, and a dynamic public IP, but again, we want to avoid defaults, not only for security purposes, but for flexibility. One thing that we'll revisit in the next module is that it's not trivial to move a virtual machine from one virtual network to another. You pretty much need to scrape the VM while saving your storage, and then recreate the VM and reuse that storage, but this time point it to the correct virtual network.

### Demo: Use PowerShell to Modify a Virtual Network
To that point, I have an instance of the Windows PowerShell ISE up. You can get to that by right clicking a Windows PowerShell icon on your system and selecting Run ISE as Administrator from the jump list. This is a bit of code that I'm borrowing from John Savill, one of my Pluralsight colleagues. This is the reference on the first line. This script is in your exercise files, so you can get to it. As you see here, I'm using the AzureRM commandlet, so you'll need to install the ARM cmdlets on your workstation. You can do that, assuming that you're using PowerShell v5, by running the command install-module -name AzureRM, and if your machine is connected to the internet you can find that module at the PowerShell Gallery. Just to quickly do a sanity check, let me do a find-module -name AzureRM, and let's verify that it is in fact on the gallery. Yeah, there it is, and once you have the ARM cmdlets we can Login-AzureRmAccount. To login with your identity set your context to the correct subscription, and then the rest of this code I'm just going to walk you through it quickly here. John Savill defines a bunch of variables to hold our resource group name, the virtual network's resource group, the VM name, it's network interface ID, the source virtual network, and the target subnet that you want to switch the VM into. So we create a reference to a specific VM. We create a reference to the virtual network, and the new get the subnet config to find out where the target subnet is specifically. Create a concrete reference to it. The actual configuration here takes place on lines 18 through 20, and it happens at the network interface level. We have to remember that in Azure Resource Manager it's very different from Azure service management that you might have previous experience with. There's a separate object with the virtual machine called a network interface, and that is specifically you tap into its configuration and its subnet identity, and then we run Set-AzureRmNetworkInterface to switch its identity. So yes, being a well-rounded Azure professional requires that you have fair PowerShell skills as well.

### The Azure Network Security Group in Action
Security. As I said before the last demo, the Azure Network Security Group or NSG is the software firewall, and this is what we use to control access into and out of an Azure virtual network on which you've populated your virtual machine workloads. Now, as I said, the Azure NSGs can be associated with an entire subnet for convenience. You can also override by associating an NSG to a network interface card on a VM. That allows you to do per host granular traffic rules. If you've ever worked with hardware or software firewalls, then you know we're dealing with controlling predominantly ingress traffic or incoming, internet-based network traffic. In this simple example I've created an NSG inbound rule. The rules are IDed. I'm just using 1000 here arbitrarily because you can have more than 1 rule associated with an NSG, and they're applied sequentially. That is, the first rule that catches a particular traffic stream will become the effective rule. This example looks for incoming connections on TCP 3389. You might recognize that port assignment is used by Remote Desktop Protocol or RDP. Now notice also, and optionally, you can constrain the IP addresses that are allowed in on that ingress point. That's very important. We want to keep in mind the fact that your virtual machines are, by definition, internet accessible. After all, if they weren't you'd never be able to connect to them. They're in the Azure public cloud after all, so we have not only the ability to specify ports and protocols, but also IP addresses. Now notice that we have bidirectional firewalling. That is, we can control the outbound traffic of your virtual machines in the Azure cloud as well. So in this example we can go outbound from my 172.16.1.10 virtual machine on TCP 5986. This is the Windows remote management, WinRM remoting port, and again, we can assign or constrain the IP addresses that the VM is allowed to connect to. You could have a VM that has very tight ingress rules, and its egress rules or its outbound traffic are only other VMs within the virtual network, you see. Thus, if I haven't overstated it already, it's utterly crucial that you master NSGs to make sure that your virtual machines are protected against all unauthorized access. Another point that's related that you might want to add to your Azure networking stack is a load-balancer. A load-balancer has a couple nice functions. One is to equitably distribute inbound load, if you have multiple web servers, for instance, that are clones of each other, that would be a good use case, but another thing you can do with a load-balancer actually is to perform network address translation. Another security principle is you always want to avoid defaults. For example, on this slide the inbound traffic rule 1000 that's looking for TCP 3389, that's a well-known default port ID. You'd want to change that to something non-standard, and let the load-balancer take an off port request, and internally translate it to the TCP 3389 that the virtual machine expects.

### Demo: Deploy an NSG
In this demonstration I'd like to show you network security groups and storage. Again, in the name of laying the foundation for deploying a VM properly in the Microsoft Azure cloud, in the Azure portal I'll come down to Network Security Groups on my Favorites list, and we'll click Add, and see what's required to deploy this object. First of all, a friendly name, and that's a good reminder that if you haven't developed a standard naming convention within your Azure subscription it's a good idea to do so. Check the exercise files because Microsoft has some guidance on that. I'll call this test-nsg. Press Tab to verify that. I'll put it in my current subscription, and I'm going to reuse my Pluralsight1 resource group in the south central U.S. So you see that creating the NSG is trivially easy. The challenge comes into configuring its rules properly. Let's refresh the view, select test-nsg, give it a click to load its Essentials page, and Settings pane. Now under Essentials, which I'll collapse, you see that we have a clickable list here. This is a live table of inbound and outbound security rules. You can also find these under Settings. Let me make sure we look at this. Separate rules for inbound and outbound, and by default, an empty Network Security Group is in fact empty. We'll give it a click, and on the inbound security rules page we'll click Add, and let's say this is going to be a Linux based VM, so we want to create an exception for SSH or Secure Shell. The priority number, you can start at 100, start at 1000. Don't start at one because that's going to prevent you from adding rules that are above it in the future. You can specify the source with a CIDR block, an IP address range, Any, which is wide open or you could specify an Azure tag. I'm going to choose Any in this simple example, and if you want to specify the port number or port range you choose Custom for the service, and then TCP, UDP or both, and then the range down here, but notice that there's a suite of different common services. If we select HTTPS, as you would expect, that rule is going to do TCP 443. If we want SSH for Linux virtual machines that's going to be TCP 22, and then, of course, the action is going to be either to allow or deny. Let's check our notification. It looks like it's creating that rule, showing up in the list, and you can get back to the rule again by visiting the inbound security rules list, and giving the rule a click. The same exact thing applies for outbound security rules. I'm not going to create one in this example, but I will show you if we click Add it's the same exact dialog box where you specify a friendly name, priority, destination, in this case, Any, CIDR Block or Tag, protocol, and port range. If you click Default rules you get a set of three rules that are ordered. Intentionally, Microsoft makes the priority super high, so they don't conflict with your rules, and this is nice because it's going to guarantee that you've got AllowedVnetOutBound traffic, Any, Any, AllowedInternetOutBound traffic, and then DenyAllOutBound, so it just gives you some initial outbound security rules to start with, as opposed to just nothing. Any custom rules you add you'll want to make the priority higher than these, so that you can catch exceptions, but this at least allows you to scope your security at an elementary level. I forgot to mention that the default rules also apply here for inbound security rules as well, and you'll notice that that allows vnet inbound traffic from one virtual network to another. It can be helpful if you do have multiple vnets, and you're not willing to set up a VPN, AllowAzureLoadBalancerInBound traffic, and then there's a blanket catch. Any good firewall is going to have a blanket deny catch at the bottom of its rule list to catch anything that's not explicitly defined, so again, keep those default rules in mind. That's a really good idea on Microsoft's part.

### Azure Storage in Action
Storage. As you see, we're looking at Azure VMs in an Infrastructure as a Service IaaS scenario. We began by looking at networking, then we looked at security, and now finally, we have storage. In the next module we'll actually deploy the virtual machine. If you see a theme here it's definitely true. I want to encourage you to lay down the foundations for your VM. In other words, build the environment for you VM before deploying it. With regard to storage, we're talking about the Operating System Virtual Hard Disk, VHD, and any data disks that you want to associate with your virtual machine. There's two models for this. There's the traditional storage account, in which you associate a storage account that has inside of it a blob service, binary large objects, which in turn is where you store your VHDs. This is traditionally how VM storage works. This can be a challenging model for the Azure administrator because you can wind up with what I affectionately call a bucket o'VHDs. There's not a one to one mapping out of the box between a storage account, its blob service, and a particular VMs storage set. You could have multiple VMs worth of virtual disks in the same blob service. Moreover, you can get VHDs mixed in with other blobs, document files, media files, and so forth. Add to that the complexity that blob service is only one of several storage related services that the storage account has, so the storage account is wonderful, it has its place, but for virtual machine workloads you might want to consider managed disks. In managed disks it's a much more virtual machine specific service, and what we're doing here is just simply saying at VM creation, let Azure take care of managing the VHDs, and for each virtual machine configuration you'll be able to get to you OS disk and your data disks, and work with them in a simpler way, frankly, than with a traditional storage account. You can still do all of the stuff that you're used to doing, capturing, cloning, backing up, and restoring, but a lot of the heavy lifting and organizational details are taken care of you by the Azure team.

### Demo: Deploy a Storage Account
To finish this demo I want to show you the storage options. If we go to Storage accounts we can create a traditional storage account here with Add, and what's neat about storage accounts is that they're multi-functional, and you'll see that in just a minute. You have to provide a globally unique name because it goes under the core.windows.net DNS name. I'll call this Pluralsightstorage2, and hope that that's globally unique. You can, in fact, attach a custom DNS name to your blob service. For account kind we can do general purpose or specifically blob storage if you have files and file system resources. This is going to be a general purpose because, presumably, I'll want to save virtual machine VHDs there. The performance tier is going to be either mechanical, lower speed storage or the higher cost, but more performant premium based storage. Your decision there is going to depend upon your speed, your need for speed basically. How many input output operations per second or IOPS your workload needs on the storage side. Azure has a number of options for replicating your storage. Check out our Azure fundamentals course for a description of what each of these means. We can, with one click, do at rest data encryption, and then the rest of this is pretty common right now. We select a subscription, a resource group, and a location, and then submit the deployment. Let's click the notification bell. It looks like the deployments just started. Well I have a couple other accounts here already created. Let me select Pluralsight1ubuntu. I just want to briefly show you what I had mentioned earlier, that a traditional storage account has a number of different services. Blobs, which is, where we're concerned, storing virtual machine disks, files, which are server message block SMB file shares, tables, and queues that are mainly of interest to developers. Table is no SQL database. Queues is a messaging, pub sub messaging system. If we go to blobs it allows us to upload content into a container. You'll notice that Azure has a built-in container called vhds that it will use to store your virtual machine vhd disks, unless you otherwise override that with PowerShell. Last thing about traditional storage. You'll notice there's a button called Open in Explorer. Let me give that a click. If you happen to have the Azure Storage Explorer program installed on your system, this is a cross-platform GUI tool that runs on Linux, Mac OS, and Windows that makes it easier to work with blob storage. It's an excellent tool, as you can see here. It's asking me to reauthenticate. I'm not going to do that, but you'll notice in the navigation bar here it says Local and Attached. There's actually an Azure storage emulator that your developers can use to write code against where you're not incurring transaction costs that you would if you were working with a live storage account up in the cloud, and then of course, you can tap into your subscriptions, and you can manage all aspects of your blob using, or your blobs I should say, using the storage explorer tool. I have a download link to the tool in the exercise files. It's really worth your while, in my opinion.

### Summary
In summary, what have we learned in this lesson? First, understanding Azure networking, security and storage is definitely dramatically going to improve your Microsoft cloud skills, make you more valuable to your company, make you a more effective administrator. Once again, to sum up, these are, that is to say, networking security and storage, the foundation on which your virtual machine deployment needs to take place. I suggest you invest study time here, regardless of whether your role in Azure is that of an architect, an operations professional or a developer because by understanding in detail how Azure virtual networks subnets DNS work, how the Network Security Group works, and how the storage model works, again, it's going to maximize your contributions to your company's Azure system. With that, I want to thank you very much for your participation, and I look forward to teaching you in the next module, which is called Deploying a Highly Available Virtual Machine.

## Deploying a Highly Available Virtual Machine
### Overview
Hello, and welcome to Pluralsight. My name is Tim Warner. This module is entitled, Deploying a Highly Available Virtual Machine. This module follows closely to what we did in the previous module where we created the foundation for a virtual machine deployment in Azure. We're going to start now with availability sets, briefly what they are, and how we can use them to plan for VM uptime and high availability. Most of our time, of course, will be spent in the Azure portal deploying a VM according to Microsoft best practices. Understand that those VMs can run Windows Server or Linux workloads. There are even third party partners that have virtual appliances that you can deploy on the cloud as well. Let's get started.

### Fault and Update Domains
Availability Sets. It's almost always, nearly 100%, a good idea to place your virtual machine into an availability set at deployment, and you'll understand shortly the at deployment piece is critical. In fact, in order to qualify for the Azure 99.95% service level agreement or SLA for VM uptime, you actually have to deploy at least 2 instances of each virtual machine into the same availability set. Now understand that that's applicable only when you're using standard storage. When you're using premium storage you have what's called a single instance VM SLA, which is kind of nice. Now then, what is an availability set? To understand an availability set we should understand what fault and update domains are. In the Azure data centers all around the world just imagine these temperature controlled warehouses with racks upon racks of servers. Fault domains are VMs that share the same power source and switch, so in this example in your Azure subscription, when we deploy a virtual machine we have up to three fault domains available, so your virtual machines can be spread across up to three racks. So, for instance, if a virtual machine is located on a hardware host, and fault domain 0 on this rack, and that rack were to have a failure, for instance, if there were a top of rack switch failure or a power failure that would bring down your workload, as long as you have another instance of that virtual machine in an availability set we're guaranteed that that workload will remain online because it exists in another rack. You see what I mean? Now you'll have to understand that these two VMs will need to be configured identically, such that that failover is transparent to your users. The update domain refers to the hardware host on which your VMs run, so update domains are VMs that share the same hardware host. You have between 5 and 20 update domains available. The situation with update domains is that you may have Azure doing planned maintenance on a rack, on a hardware host that your VM is on, and may require a reboot or a restart of the hardware host, which, by definition, would interrupt service with your VM, you see, so as long as you're on a separate update domain, it could be within the same rack, it could be on a different rack, it doesn't matter, the idea here though is that it's a separate host. You can protect your workloads against a host level restart. One best practice is to place VMs of each app tier into their own availability sets. You may have in your azure IaaS infrastructure a two tier app where you've got web frontend/app servers, and then database servers. You could do an availability set for each tier.

### Demo: Create an Availability Set
Let's deploy a virtual machine to Azure shall we? Before we go to the virtual machines node here and deploy the virtual machine though, let's first go to availability sets. The final piece of the foundation that is yet to be laid is this construct called the availability set. It's free to create these. They don't have a separate charge, so that shouldn't hold you back from creating these. Let's click Add, and I'll show you the required metadata. Most of this is a repeat basically. I'll call this test, test-availability-set. I'll reuse the resource group that I've been using all along in this course, Pluralsight1, verify my location. The only part that's unique to the availability set is where you can adjust the number of fault domains and the number of update domains that you need. If I plan for this availability set to contain a couple web frontends, let's say, then I could adjust the sliders as such, and we need to tell Azure in advance, is this going to work with managed disks or traditional storage? A yes means that it's a managed disk option, and we'll click Create. That's an important consideration because Azure manages disks, that is OS and data disks for your virtual machines, differently in each model.

### Demo: Deploy a Virtual Machine
Now that we've done that we can finally go to the virtual machines node on our Favorites bar, and we'll click Add to start the VM deployment process. It takes us to the Azure marketplace where we have the ability to search across all of the virtual machine images in the library. For instance, if we wanted Windows Server 2016 I can just start to type, and notice that we have images for 2016 Datacenter, Nano Server, Contain host, the hub option for Enterprise agreement customers. Alternatively, we can scroll down, and we see a recommended row with Windows Server, and the endorsed Linux distributions like Red Hat Enterprise, Ubuntu Server. You can go on from there into virtual machine images that are preloaded with Enterprise software, and the licensing and the pricing details you can get in our fundamentals course. Also, check the exercise files because I provide helpful links there. Notice that there's appliance images from several third party partners. Veeam Enterprise Backup, for instance. There's the Drupal content management system. I'll show you something that's really cool here. Let me do a search for SharePoint 2013. Notice that there's an HA Farm option, and this is a super powerful template. I'll click it, and the information blurb tells us that this single template will deploy a SharePoint Server 2013 3 tier farm that consists of 9 servers and 29 CPU cores. Wow. The ability to deploy an entire environment, that is what Azure Resource Manager is all about. In this example let's choose the Windows server recommended option, and specifically look at all the options here. There's Server 2012, Server 2008 R2 SP1. I'm going to select the Windows Server 2016 Datacenter image, and we want to make sure that for deployment model we choose Resource Manager rather than classic. We'll click Create, and it's a four step process, the first of which we give the VM a name. I'll just call it vm02. Your storage could be SSD, that's premium storage or HDD. If you're going to do HDD remember the availability set requirement. We don't want to use a default administrator name, so I'm going to choose something not default. We need a strong password, so I'll supply and confirm that, verify the subscription, resource group, location, and click OK. One of the many beautiful things about infrastructure in the cloud is that you can scale your virtual machines up and down, out and in very simply. What we're doing here is selecting an instance size for our virtual machine, and depending upon your requirements, your workload, what it's skewed towards, is it skewed toward compute, is it skewed toward terminal services? I mean the sky is the limit, as far as what the VM does. You would choose an image that has the CPU cores, the memory, the number of data disks that match your workload. I'm going to select D1_V2 standard. That's a good middle of the road option here. In step three this is probably the most complex step because of all of the moving parts here. For storage we can choose either managed disks or to use a traditional storage account. If we click storage account the template will create a new one for us by default, but you can override that if you already have an existing storage account that you want to store the VHDs in. If you choose Yes to use managed disks notice that the storage account option goes away. For network this is where we can take advantage of the network that we created earlier. The template will create a new virtual network if you don't already have one created. If you have previously created vnets it may choose the wrong one. In here it's choosing one I've created called Pluralsight-vnet, so let me click virtual network, and make sure I select the one that I actually want. In this case, it's vnet1, and then if you have multiple subnets defined, it looks like I don't in this case, you would make the appropriate choice. Of course, after the fact it's easy to switch subnets, but it's not as easy to switch virtual networks, so planning is important. For you public IP address the default option is to use a dynamic one, but you can override that and choose a static address to make sure that your VM will always listen at a particular public IP address, and that public IP does show up as a separate object that you can manage in Resource Manager. Network Security Group. Again, very crucial here that we click in here, and we select the NSG that we actually need. I've created one that I've optimized for Windows Server workloads, and I'll make sure to select that one. We'll deal with extensions in the next module, so I'll bypass that now, but high availability, this is too easy to bypass. You don't want to do it because you have to assign an availability set at VM creation. I'm going to select one that I've created earlier called win. Finally, we can enable or disable boot diagnostics or guest OS diagnostics. I think we want to enable both of those. The diagnostics will be stored in a storage account, so you'll have to specify the name of a storage account, but if you've already created one, and you're already expecting particular data that's great. I've created one called psdiag1000, so I'll want to select that and click OK. A final validation occurs on that deployment, and we can click OK to submit the deployment or, well and not or, we can click download template and parameters, and this shows you the underlying JSON, the ARM deployment template that is described by what we've chosen. You see here under Resources we're creating a virtual machine resource, we have an availability set, network interface card, and a public IP address resource, and each one of those is declaratively defined using this key value pair syntax that JSON gives us. Now we can actually add this template into our Azure subscription. We can deploy from here or we can download the template to our system, which is what I'll do right now, and then I'll open that zip file to show you what it looks like, that inside we have the template.json that defines the actual deployment. You can parameterize a template to change it, so that you can rerun the template providing different input parameters, and then notice that the zip gives you deployment helper scripts. There's a PowerShell deployment helper, a Bash, Shell Script. There's a Ruby file, a C# source file, and a deploy-preview Shell Script, so the Azure team has really thought ahead in making it as easy as possible for us to deploy resources. We'll click OK here, and that will submit the deployment into Resource Manager, and if we come up here to the Notification bell it tells us the deployment started. Now these are actually hyperlinked notification items, so if I click this it actually will take us to the deployment page where we can see specifically what's happening. You may want to periodically refresh the view to see what's up, and if you scroll down under the metadata the operational details tell you step by step what it's doing, what it's done, and if you click an entry there it may give you some additional details. This can be very helpful when you're troubleshooting deployments, and you're perfecting them.

### VM Deployment Methods
VM Deployment. First of all, let's take a look at the various and sundry ways that we can deploy Windows server and/or Linux VMs to Azure. First, we have the Azure portal, the web portal that we've been using all along, and will continue to use. Next, programmatically, we have PowerShell. The requirement here, we touched upon this in the previous module, is that you've installed the Azure RM PowerShell modules. Azure CLI was formerly called Xplat CLI. This is the Azure command line interface. It's an open source Python application. Version two is Python, and it runs on Windows, Linux, Mac OS. You can perform full VM lifecycle management programmatically in that tool. Azure Resource Manager, that's what ARM stands for, uses JavaScript object notation or JSON templates to define every deployment, so it stands to reason that you can use Visual Studio, Visual Studio code or your other favorite IDE or code editor to develop ARM templates, and declaratively define your deployments, and do full lifecycle management of your VMs. ARM templates are extraordinarily powerful. If you're a developer you have the Azure software development kits, not only for .NET, but for many other programming languages in the world. It's a new Microsoft where we have a high degree of open source code from Microsoft up in the GitHub cloud, and we have more cross platform ability, if that's a word, than ever before. It's a great time to be an Azure professional for sure.

### Best Practices to Keep in Mind
What are some best practices to keep in mind in performing a deployment, a VM deployment? First, make sure that your virtual network is created, tuned, all set up before deployment. The ARM templates that you have in the Azure marketplace will almost always give you a generic virtual network if you just click Next, Next, but you don't want to click Next, Next when you're deploying a VM. You want to be specific, and you should know in advance what virtual network you want to use, what subnet you want to use, what network security group you want. Availability sets need to be associated to your VM during deployment. A common mistake is to forget this, and then realize you have to scratch the virtual machine, save the storage, and then recreate it into an availability set. NSGs, as I said, create those, define the inbound and outbound rules prior to deployment to make it a lot easier. Naming conventions. Check the exercise files because I give you a link to Microsoft's write-up on that. It can be challenging, especially if there are multiple Azure administrators, to know what's what just by inspecting the names of your resources. It's a good idea to standardize for VMs you're going to use VM, for NSGs you're going to use NSGs, and you'll notice that the default names you see in the Azure portal will give you a good head start on standardization. Finally, for deployment scripts, regardless of whether you're doing direct ARM templates or PowerShell or CLI, save your work, and potentially put it in source code control, so that you can track changes over time.

### Demo: Review VM Configuration
The VM that we created in an earlier demo looks like it's still in a creating state here, and that's fine. We can take a look at a couple other virtual machines that I've deployed. The workflow that I showed you works exactly the same for Windows Server or Linux VMs. As a matter of fact, the entire lifecycle pretty much is the same. I'm selecting my Ubuntu virtual machine, and I want to draw your attention to a few settings in particular. Let me scroll the settings up here. We have Availability set, Disks, Network interfaces. Let's go to Network interfaces here. Remember that in Azure resource manager your network interface is, well, the networking subsystem of your virtual machine, and one beauty of it being separate from the VM is that you can detach it and reattach it to the same or a different virtual machine. Let me select this network interface in the list, and let's review its settings briefly, and what I want to draw your attention to here is two things. First, the Network Security Group. I need you to understand that the NSG can be bound directly to an interface card or, perhaps more commonly, to a subnet, and you notice that if we click this Ubuntu NSG it'll jump directly to the NSGs property pages. For IP configurations this is where we can modify the IP address or addresses that are bound to this virtual machine. You're going to need at least one public IP address to be reachable across the internet, and then there'll be internal or private IP addresses. It's up to you how you want to manage those. They're going to come from the virtual network subnet on which the machine exists, and notice how easy it is right through the Azure portal to change the subnet identity. I don't have one, so opening the dropdown actually doesn't do anything, but you don't necessarily need to go to PowerShell to change the subnet identity of an IP address on a NIC. Okay, so let's close out of there. Back to the Ubuntu virtual machine configuration.

### Demo: Work with Availability Sets and Managed Disks
I want to go to Availability Set, and you'll notice here that it says the availability set can only be configured when creating a virtual machine. You must recreate the VM to move it into our out of an availability set. If the VM does belong to an availability set, Azure will show you its current fault, and update domain IDs. In this case, the VM belongs to an availability set called Ubuntu, and its fault domain and update domain are ID 0. I want to draw your attention to this page from the technet script gallery. This individual here, Samir Farhat, created an Azure function called Set-ArmVmAvailabilitySet, and I've run it. It works really well. It does enable you to change an ARM VMs availability set, but there's no magic here. Essentially what the script does is automating, deleting the VM, and deploying an identical one using in its existing storage, but pointing it to a new availability set, so this underscores the fact that whereas a particular task may not be available natively in Azure, but sometimes you can turn to the technet galleries, the PowerShell Gallery, GitHub, and look for community involvement to solve a particular issue that you're working on. Let's come back to our virtual machines node and refresh. Our vm02 looks like it's running now, so I want to give that one a click, and again, I just want you to inspect and verify that the settings interface is identical to what we saw with a Linux virtual machine. I want to click Disks here just to compare and contrast the workflow between managed disks and traditional storage accounts. You'll recall that I used managed disks for vm02, so what we have here is a simple table where an entry for an OS disk, and then we can add one or more data disks up to our instance size. Recall that your instance size is going to give you x number of additional data disks, and to do that we can just simply create a disk here, and fill out the Create managed disks blade. I'll call this datadisk1, verify my resource group. The account type can be standard or Premium_LRS, depending upon whether you're using HDD or SDD storage. The source here can be a snapshot that you've created previously that's a point in time backup of a managed disk, a storage blob that exists in a storage account or just a new empty manage disk, and then you can choose the size, and it gives you an estimated performance rundown, and there it is. We can adjust the caching options. Your choice here is going to, again, be determined by the workload that you're using. We'll want to make sure to save our change to commit it. Let me finish by showing the difference between the managed disks, and when you're using a traditional storage account. And now I've just deployed a new VM called vm05, where I explicitly chose to use a storage account rather than manage disks for the virtual machine disks. Now in the Settings pane, if we click Disks, we see an interface that looks exactly like what we saw for the previous VM that was using manage disks. Now that's nice from a consistency standpoint, but what we'll see if we go back to the Favorites bar, and navigate to storage accounts, and if I go into the storage account that I created for this use, 01vhdstorage01, and then into the blob service, we have a container called vhds that ARM created automatically, and then we have the VHD for that virtual machine specifically. When you're using manage disks you don't have direct access to the VHD. You don't have a potentially publicly accessible URL like you have here. The general purpose suggestion for new deployments from Microsoft is to use manage disks unless you have a compelling reason to use the traditional storage account.

### Summary
What have we learned today? Well, first of all, planning in advance is crucial for any work you do in Azure, specifically with virtual machine deployments. We don't want to do next, next, and accept default, so that's been a running theme throughout this course isn't it. I didn't mention this specifically, but let me mention it now that those ARM deployment templates that under gird any deployment you do in Azure are idempotent, so what this means is any resources that are defined in the template will be created. Azure will make it so. Thus, you may have an armed template that defines a virtual network, and you want to add another subnet to that virtual network. You can simply modify the deployment template, and actually run the entire template against Azure. It won't disturb anything that's already defined and created that's referenced in the template, but it will make any modifications. Beautiful system. I'm a huge fan of ARM templates and Azure motivation in general. With that, thank you, as always, for your participation. I appreciate that. In our next module we're going to work with configuration management and disaster recovery, and the idea here is we've done our VM planning, we've laid the foundation. We've actually deployed our VMs now. What can we do with these already created virtual machines? I'll see you then. Take good care.

## Implementing Configuration Management and Disaster Recovery
### Overview
Hello there, and welcome to Pluralsight. My name is Tim Warner, and this module is entitled, Implementing Configuration Management and Disaster Recovery. We have two main subjects to learn in this module. The first is agents and extensions. In the previous couple modules of this course I showed you how to deploy virtual machines according to Microsoft published best practices. Now I want to show you some of the things we can do to an already deployed virtual machine, what the VM agent is, and how it works, as well as first and third party extensions that extend the functionality of your VMs in the Azure cloud. We'll also cover backup and restore scenarios looking at the Azure Backup and Azure Site Recovery services. I will say, though, that this module will be almost entirely devoted to single VM backup. It's important that I teach you how to work with Azure Backup and Recovery at a single VM level, but Site Recovery and Operations Management Suite or OMS are also on the menu, but to a lighter degree. Let's get to work.

### Azure VM Agent
Extensions and Agents. First, the Azure VM Agent. This is a lightweight process that's super important. It's required really, for you to have running on all virtual machines running in the Azure cloud, and what it does is it serves as an intermediary between the virtual machine itself, and the Azure fabric controller running in the Azure datacenters. Now both Windows Server and Linux have Azure VM agents available. The code is maintained by Microsoft, although the Linux VM agent is an open source project at GitHub.com. Any virtual machine image that you deploy from the Azure marketplace, the Azure Gallery, will have the VM agent preloaded, and there's nothing you need to worry about as far as installation or upkeep. It'll just be automatic. For virtual machines that you may have on-premises, and you've migrated into the cloud, you'll want to download the VM agent. Check the exercise files because I give you download links to the Windows Server version that is from the Microsoft Download Center, as well as the Linux VM Agent that, as I said, is available in GitHub.

VM Extensions
An extension is a piece of software or potentially a script that, well, extends the functionality of your virtual machine. Configuration management refers to how you and your colleagues in the IT department ensure that your workload servers are in compliance with your policies and procedures. You may be using Desired State Configuration or DSC in Windows PowerShell to keep your Windows servers in compliance. You may be using third party CM tools like Chef or Puppet with both Linux and Windows server agents. We have, as you can see on the left, this is a screenshot from the Azure portal, a number of built-in extensions that are in the extension gallery. There are others that are not in the gallery, but you can install and manage through Windows PowerShell or the Azure CLI. Data protection is a large category in there, specifically antimalware extensions, backup agents. Because we're talking about Infrastructure as a Service virtual machines there's nothing to prevent you from manually or automatically deploying your agents with your own configuration management tools, but the purpose of this module is to show you how to use the Azure based VM extensions.

### Demo: Interact with a VM in Azure
In this demonstration we'll work with virtual machine extensions and agents. To get started we'll come over to the Virtual machines node where you'll see I have two virtual machines running. These are both Windows Server 2016 VMs, not that it matters necessarily. The Linux and Windows server extension gallery are not identical, but they're quite similar. Let me select vm01 at random, and you can see under Settings here we have Extensions, but actually, before I click that I want to draw your attention to above the Essentials pane you have this control strip. Connect is going to open up an RDP connection, as you can see here, that has prepopulated the IP address of that virtual machine, and if I click Open, and actually open the connectoid, we'll be prompted for an administrator credential that you, that we, I should say, declared during deployment. I'll submit these credentials, except the certificate, the self-signed certificate that's coming from the VM, and before you know it we'll be logged into this virtual machine, and we'll be able to interact with it in exactly the same way that we can interact with virtual machines on-premises. In this respect, cloud based virtual machines are indistinguishable from on-premises ones; behaves exactly the same. Now, I have a quick trivia question for you. How and why were we allowed to connect to this virtual machine through RDP? If someone else were given this public IP address, and they attempted an RDP connection would it succeed or fail, and what is that dependent upon? Recall that the Network Security Group or NSG is what protects access, and the reason why I got in is because I've created an NSG allowance. We can see the NSG by clicking Network interfaces, and it tells us that the Windows NSG object that I've previously created is what's allowing that to happen. Okay, let me come back to Overview. Besides the connection workflow, the other thing I think that's important for you to know, if you don't know already, is how to deallocate or stop a virtual machine. Now if I was in an RDP session, and I issued a shutdown command, then the VM would stop, but it would not have its resources deallocated. Now the deallocated state is the only VM state that does not accrue permanent runtime charges, okay, so if you need to shelve a VM, and you do not want to accrue charge, make sure to click Stop here on the toolbar, and it'll say, Stopped deallocated instead of just stopped, okay. A hazard about stopping the VM without deallocating it is that you may lose your public IP address if it was dynamically generated. If it was a static one, then you're paying a small fee for that, so you get to keep it.

### Demo: Manage VM Extensions
Let's come down to Extensions, and I'll show you how to add one of the gallery extensions to your virtual machine. Looks like there's a, let me stretch this out, an EnterpriseCloud.Monitoring. Oh, that's because I've on boarded this VM with OMS, that's right, and there's an Azure diagnostics extension, so actually the provisioning of both of these came not through the gallery image, the ARM template that this VM is based on, but out of a separate step I did in onboarding them with operations management server. Well anyway, we can click Add to open up a new blade that gives us a choice of all available gallery extensions, and as I said before, they're broken into categories. There's monitoring agents for partners, there's some Microsoft ones here. There's Custom Script extension, which is useful if you have a first run configuration script you can have that PowerShell script run automatically at first launch. Scroll down further. We have Puppet and Chef extensions to help you onboard into those configuration management systems. There's Desired State Configuration if you want to onboard a VM into DSC. Microsoft Antimalware is one of the antimalware clients. Let's actually do this one. We'll click Create. Each extension is going to ask you some different things just by definition. Let's see what the Microsoft antimalware one asks us. Looks like it's just basically giving us traditional choices that any antimalware scanner would. What exclusions do you want to include, if any? Enabling or disabling real-time protection, enabling or disabling scheduled scans and scan types, and so forth. Let's click OK, and check our Notifications, and it looks like that deployment has started. It's just as easy as that to install extensions on virtual machines. I had mentioned that not all available extensions show up in the portal. Let me open up the PowerShell ISE by right clicking the PowerShell icon, and selecting ISE as an administrator. I have a PowerShell one liner in my clipboard. I'll Ctrl+V to pop that in here. This is some code from the documentation that I'd like to point you to. Check the exercise files for that. You're going to need the Azure RM PowerShell modules installed, and I'm going to need to login to my account here, my subscription, an interactive login. I'll provide my Microsoft id email address. It's going to redirect me via federated, identity, and oath back to the Microsoft Identity provider, put in my password, click Sign-in. and then I'm redirected back to Azure. It looks like it's associated with my corrupt subscription, so I don't have to use Set-AzureRmContext, which is cool. Anyway, this is a one liner that brings in three AzureRmVM cmdlets, and we don't have the time or scope to explain them in detail. The back tick or gray accent that you see here simply allows us to break this code across multiple lines. Let me select those, and then we could type F8 or click Run Selection. And this is just a one liner that's intended to give us some visibility as to the extensions that are available. Uh oh. It looks like it's giving us all versions, which is going to be a little bit redundant. I pressed Ctrl+C to stop that output, and I've come back here and added a single flag to my Select object, Unique, that should give us a little bit better output. First, let me look at the two pane view. Do a CLS to clear the screen, and let's run this code once again. Okay, that came back. Just quickly, what this pipeline is doing is getting all image publishers in a particular region, because the extensions are tied to the operating system images, remember, and then in the middle part of the pipeline we're getting the type, and then finally VM extension images, and selecting only two columns, Type and Version. Okay, well there's still some duplication, but not as bad. Let me scroll up to the top or near the top. There's a number of VMAccessForLinux. That's the virtual machine access extension that we started this module learning about. There's also one for Windows. OmsAgentForLinux you can see. VMAccessAgent, that's the Windows VM agent. So anyway, I just wanted to quickly show you that, that sometimes PowerShell can give you visibility into resources and options that you may not get out of the box in the portal itself.

### Azure DRaaS
Backup and Restore. Having a highly available virtual machine involves not only redundancy at every level, storage replication, and so forth, but it also requires regular backup. There's two options here in Azure that I want to tell you about. First is Azure Backup, and this is a policy-based backup and restore solution that works with both "Born in the cloud" VMs, which is to say VMs that are always in Azure, as well as on-premises VMs, and I think it's really cool that Azure supports not only Hyper-V, but VMware hypervisors and VMs. By policy-based I mean that one of the things we do in Azure backup setup is you determine, number one, how often Azure will take a VM backup, and number two, how long you want to retain those backups. There are some really cool granular restore options that I'll show you in the demo. Azure Site Recovery is the other pieces of the puzzle, and this is a hybrid cloud VM replication solution, so what you're doing here is potentially taking an entire application workload that could involve several virtual machines and other assets, and replicating them in a hot standby way. We could be talking about on-premises resources replicated to Azure, Azure to on-premises or Azure to another Azure instance or another cloud providers instance, and with site recovery the idea is you can fail over your workload to the cloud or to a second on-premises datacenter very quickly and easily. A very powerful tool this is. ASR is what it's called for short.

### Operations Management Suite (OMS)
Behind the scenes in Azure we have a number of integration points with a product quite that Microsoft has called Operations Management Suite or OMS. OMS really is Azure. As I said, there are four main solutions that the OMS product family works with. There's Insight and Analytics. You might have used the log analytics tool in the Azure portal. Well, behind the scenes that's OMS powering it. Automation and Control. I, myself, am familiar with Azure Automation DSC where you can deploy cloud-based desired state configuration pull servers. As well, you can do many other configuration tasks like updating, patch management, and so forth. There's Security and Compliance, robust security scanning, checking, reporting, remediation, but the solution that we're concerned with in any degree is the Protection and Recovery one, of which Azure Backup and Azure Site Recovery are a part. OMS, like I said, is integrated natively behind the scenes. Many times you may not know you're working with OMS services directly. There's a free tier, as well as a paid tier in OMS, and at the appropriate time you're given the choice of which service level you want. In the demo today we won't need to pay for anything beyond our traditional storage and compute Azure costs.

### Demo: Back up a VM in Azure
In this demonstration we'll work with Azure VM Backup and Recovery. The place to start here is the Recovery Services vaults. Remember, I showed you in the first module how you can add or remove items from the Favorites list. I added a node for Recovery Services vault, and you see I've already created one. To show you what the creation process looks like we'll click Add, and inspect the blade that appears. The blade would lead us to think that the Recovery Services vault initially is simply a container into which your Azure Backup and Azure Site Recovery policies exist, and that's true. You're simply giving the vault a friendly name subscription resource group and location. Let's click the Pluralsight-vault that I've previously created in my Home region, and once you have the vault up and running you see we have quite a few moving parts, at least potentially. We have action buttons up here for Backup and Replicate. Namely, this is Azure Backup and Azure Site Recovery. We have some really interesting tiles here in this dashboard area that shows us backup alerts over the past 24 hours, and then there's tiles for site recovery if you've configured it. Under Backup we have Backup Items, Backup Usage, and Backup Job. It looks like I had one fail. That's interesting, and then under Site Recovery, if you're using that, we can look at what's been replicated, what our recovery plan is, and what site recovery jobs are either in progress, in stuck state waiting for input or having failed. Now, if we come over to the Settings list there's quite a bit here. I want to bring us to Getting Started. There's two nodes here, one for Backup, and one for Site Recovery. Essentially, Site Recovery allows you to set up a hot standby, a disaster recovery site. The three steps are to prepare your infrastructure, replicate your application, and then manage how you're going to recover it. Is it going to recover to an on-premises datacenter or the Azure cloud or somewhere else you see? I'll just stop us here at the first step where we're asked for the protection goal, and Azure asks us, where do you want to replicate your machines? To Azure or to another recovery site? Are your machines virtualized? And your choices are Hyper-V, VMware vSphere or Not, and then you're asked whether you're using System Center products, that's the on-premises Microsoft datacenter management toolset, in particular System Center Virtual Machine Manager, VMM, to manage your hosts, and then if you click OK, depending upon your choices here, you'll be taken through the wizard in a different way. Here we're selecting our VMM server and associating hosts. It's an involved process, but I wanted to make sure you at least knew where to go initially to see it. What we're spending our time with here is the goal of scheduling a backup for our virtual machines, and testing restore. Let's go to Getting Started, Backup, and our Backup Goal here, where is our workload running? Well, it's in Azure. What do you want to backup? It's a virtual machine. Let me click OK. We're asked to use either the default built-in backup, which is a daily 9 PM backup, with a 30 day retention. Alternatively, we can create a new policy if we don't want the default. I'm going to use the default here, that's just fine. Alright, so once we have our policy specified we can click OK to move to step three. The final step, called Items to Backup, is where we onboard virtual machines into our backup policy, and as you've seen, I have two VMs, vm01 and vm02, part of the same resource group. I'm going to onboard them simply by selecting them in the list. Now you may have many, many virtual machines across different resource groups. You can use this Filter items to make finding them easier, and then click OK to complete the step. We now can run a final validation by clicking OK, and the Getting Started page, and then as usual, opening the Notification menu to check on the status of the deployment. Let's go ahead and click this, and look at the details down below under operational details. We can follow the onboarding, and wait for it to complete. So, at the end of that process you'll have yourself some protected items that we can view down below. If we come under Protected Items, Backup items we can round up either Azure Virtual Machines, of which, like I said, I've added two to this backup plan; on-premises machines that you've installed the Azure Backup Agent to, look for the exercise files for a download link and documentation. If you're using System Center Data Protection Manager or Azure Backup Server, which I like to describe as an Azure cloud based specialized version of System Center Data Protection Manager. For now, though, let's click the Azure Virtual Machine Type, and we're going to see my vm01 and vm02 machines that I've added. Their last backup status shows successful, and we can review which policy we've attached to these two. Let me select vm01, and when we're looking at a backup item you'll notice on the toolbar we can do an immediate backup. If we already have one backup we can do a restore or we can do file recovery. This is a public preview feature. It may still be in preview by the time you're watching this or it could already be a released feature, but basically the workflow for file recovery is that you can choose a recovery point, in other words, a backup of your virtual machine, and then from that recovery point you would download this executable script that will mount all VHDs from the selected recovery point as local drives on your machine. They'll remain mounted for 12 hours, the documentation tells us. The idea there is that you can just copy off any data directly from those disks that you need. Isn't that convenient? And then you could always manually unmount the disks. That's file recovery. Now going forward we can review and perhaps modify our backup policy to adjust the VM scheduled backups, but if we want to take an Adhoc back up from the Azure portal, as you see here, we can click Backup Now, specify a retention setting, it defaults to 30 days from now, and then we'll click Backup to submit the deployment job, and again, I'm sounding like a broken record here, but we can watch the progress of that through the notification system. An Adhoc backup job in Azure is called a triggered backup, and the notification says we can monitor progress on the backup jobs page, and this will actually link directly to that page, and we can now see that the vm01 job is actually in progress right now. Once this completes we'll be able to take advantage of that backup in various recovery and restoration scenarios.

### Demo: Restore a VM in Azure
Let's simulate a catastrophic failure, in which case we need to restore a VM from a backup. Well, as I just showed you, the path for that, let me scroll back again, to make sure you understand, is your Recovery Services vault, Backup items, the source where the virtual machine is, and if it's an Azure virtual machine that's the category it'll be in, the specific VM in question, and then the backup item blade, we'll click Restore VM. We have an Application Consistent unencrypted image with this date stamp. Over the last 30 days you'll see a running list of crash consistent, application consistent, and file-system consistent backups, and you can filter that view by choosing this dropdown control. Let me select this restore point and click OK. We have an information dialog up on the top here that says to create an alternate configuration when restoring your VM use PowerShell cmdlets. Again, check the exercise files because I give you some documentation on that. Here we're assuming we need the same configuration as the original VM. Notice that the Restore Type is to, by default, create a new virtual machine that's a clone of the existing one, so we would want to, at the very least, stop the source virtual machine. We can, alternatively, simply restore the underlying disks to either a traditional storage account or the managed disks eco system. I'll call this vm01r. Verify the Resource group, Virtual network, Subnet, and Storage Account, I actually need to change that, and click OK. To kick off the restore we'll click Restore, and as always, we can follow the status of a deployment by opening the notifications menu, and clicking the entry. Now notice that you can build up quite a record of notifications. The Dismiss all option does exactly what you think it is, but I want to click this deployment, so we can it more closely. I guess now I'll click Dismiss All. After dismissing all we have a new notification that the restore is triggered for that VM, and we're instructed to monitor progress on the backup jobs page. Let's click out of there, and go back, and under Monitoring and Reports we have a Jobs entry. Backup Jobs is what we want, and we have a restore operation in progress here. Up above the Job Type says that we're recovering the VM to an alternate location, and it looks like there are two subtasks, transferring the data from the vault, which is in progress, and next to create the restored virtual machine. In case you're wondering what happened here with this Failed status, let's give that a click, and under Error details it says, Unable to initiate restore as another restore operation is currently in progress. Basically what happened was I started a restore, and inadvertently thought that it didn't go through, so then I redid or reran the restore, so it caused the first one to fail. The take home message from there is twofold. One, keep your eye on the notifications area, in particular, when it's clickable to look at the deployment details. In fact, clicking this notification it looks like, takes us directly to Backup jobs, and number two, actually read what Azure is doing when it's deploying. You can learn a whole lot, and you'll find that the feedback that you receive is quite robust and understandable. While we're waiting for that VM restore let's take a look at another VM in Azure. This is my vm02 virtual machine, and in the Settings area, besides scrolling, you can always do a search, and let it filter, so if I type backup you'll notice that we have a setting at the VM level called Backup, and if we give that a click we're going to see which recovery services vault that VM has been associated with, and we get down below in the dashboard a list of backups, which basically are the same thing as Restore points, and what's even cooler here is that instead of drilling in through our Recovery Services vault into backup items VMs we have the Backup now, Restore VM, and File Recovery Preview options immediately accessible. Isn't that awesome? And if we click Settings that allows us to get and edit the Backup policy if we so need. It's quite straightforward. Once you get passed your initial learning curve, I think you'll be really excited at how straightforward this is.

### Summary
In summary, what have we learned in this module? I submit to you that Azure is well-suited to both kinds of workload, and what do I mean, both kinds of workload? Well, there's the "born in the could" workloads where you deploy IaaS virtual machines that function together and deliver services, and you don't have really anything to do with your on-premises environment. By contrast, many companies have a hybrid cloud, in which you may be extending your on-premises network up into the Azure cloud and back again, and Azure is well-suited for both in terms of configuration management, as well as Disaster Recovery as a Service, DRaaS. We learned that Operations Management Suite, or OMS, extends the base Azure functionality in a really powerful way, and equips you to take your Azure work further, and I hope you do just that. That's the conclusion of this course, and I want to thank you very much for your participation. I'd love to keep in touch with you, so if you want to write me an email my email address is tim-warner@pluralsight.com. You can also find me at Twitter. My handle is @TechTrainerTim. Thanks again, and I wish you all the best.

## Course author

Tim Warner
Timothy Warner is a Microsoft Most Valuable Professional (MVP) in Cloud and Datacenter Management who is based in Nashville, TN.
